# RAG Retriever Comparison
# Compare ChromaDB vs Qdrant on retrieval quality and performance
# Latency threshold: 2000ms (standardized baseline for vector search)

description: "RAG retriever comparison - ChromaDB vs Qdrant"

providers:
  - id: file://../../../src/financial_rag/providers/retriever_only.py
    label: "ChromaDB"
    config:
      vector_store: chromadb
      top_k: 5
      return_format: text

  - id: file://../../../src/financial_rag/providers/retriever_only.py
    label: "Qdrant"
    config:
      vector_store: qdrant
      top_k: 5
      return_format: text

prompts:
  - "{{query}}"

tests:
  # Test 1: Apple iPhone - tests product-level retrieval
  - vars:
      query: "Apple iPhone revenue Q3 2023"
    assert:
      - type: latency
        threshold: 2000
      - type: icontains
        value: "iPhone"
      - type: llm-rubric
        value: |
          Does the retrieved content contain iPhone revenue or sales data
          from Apple's Q3 2023 financial reports?
          Score 1 if relevant data found, 0 otherwise.
        threshold: 0.8

  # Test 2: Microsoft - tests company-level retrieval
  - vars:
      query: "Microsoft total revenue quarterly report"
    assert:
      - type: latency
        threshold: 2000
      - type: icontains
        value: "revenue"
      - type: llm-rubric
        value: |
          Does the retrieved content contain Microsoft's total revenue
          from quarterly financial reports?
          Score 1 if relevant data found, 0 otherwise.
        threshold: 0.8

  # Test 3: NVIDIA - tests segment-level retrieval
  - vars:
      query: "NVIDIA data center revenue Q3"
    assert:
      - type: latency
        threshold: 2000
      - type: icontains
        value: "Data Center"
      - type: llm-rubric
        value: |
          Does the retrieved content contain NVIDIA Data Center segment
          revenue from Q3 financial reports?
          Score 1 if relevant data found, 0 otherwise.
        threshold: 0.8

  # Test 4: Intel - tests cross-company retrieval accuracy
  - vars:
      query: "Intel processor revenue breakdown 2023"
    assert:
      - type: latency
        threshold: 2000
      - type: icontains
        value: "Intel"
      - type: llm-rubric
        value: |
          Does the retrieved content contain Intel revenue or processor
          sales data from 2023 financial reports?
          Score 1 if relevant data found, 0 otherwise.
        threshold: 0.8

evaluateOptions:
  maxConcurrency: 1
